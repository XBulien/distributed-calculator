# Распределенный Калькулятор

Этот проект реализует систему распределенного калькулятора. Она состоит из оркестратора и нескольких агентов, которые выполняют вычисления.

▌Архитектура

Система работает следующим образом:

1. Клиент регистрируется через API.
2. Далее клиент авторизуется и получает токен для совершения запросов.
3. Клиент отправляет запрос на вычисление в Оркестратор через REST API используя свой токен.
4. Оркестратор сохраняет задачу и присваивает ей уникальный ID.
5. Агенты опрашивают Оркестратор на предмет новых задач через внутренний API.
6. Оркестратор предоставляет ожидающие задачи доступным Агентам.
7. Агент выполняет вычисление и отправляет результат обратно в Оркестратор через внутренний API.
8. Оркестратор обновляет статус задачи и результат, делая его доступным для получения клиентом.
9. Клиент получает результат через REST API, используя ID задачи.
10. Результат задачи сохраняется в базе данных для дальнейшего воспроизведения.

## Быстрый старт

### Требования
- Go версии 1.20 и выше
- SQLite3

▌Инструкции по Сборке и Запуску

1. Клонируйте репозиторий:

  
```
    git clone https://github.com/XBulien/distributed-calculator.git
    cd distributed-calculator
```

2. Соберите компоненты:

```
   go mod tidy
```
 Эта команда соберет бинарные файлы оркестратора и агента.

3. Запустите оркестратор:

```
   go run cmd/orchestrator/main.go
```

Это запустит оркестратор по адресу http://localhost:8080.

4. Запустите агентов:

```
    go run cmd/agent/main.go
```

Это запустит агента, подключенного к оркестратору по адресу http://localhost:8080.
Вы можете настроить адрес оркестратора, используя переменную окружения ORCHESTRATOR_ADDRESS.

**Рекомендуется выключить антивирус на время работы с проектом**

▌Пример использования API

Аутентификация
# Регистрация пользователя
```
curl -X POST http://localhost:8080/api/v1/register \
  -H "Content-Type: application/json" \
  -d '{"login":"user1","password":"pass123"}'
```

# Вход в систему (получение токена)
```
curl -X POST http://localhost:8080/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{"login":"user1","password":"pass123"}'
```
**Важно**: Токен валиден только **24 часа**

Управление задачами

# Отправка выражения на вычисление
```
curl -X POST http://localhost:8080/api/v1/calculate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ВАШ_ТОКЕН" \
  -d '{"expression":"2+2*2"}'
```
# Проверка результата по ID задачи
```
curl -H "Authorization: Bearer ВАШ_ТОКЕН" \
  http://localhost:8080/api/v1/expressions/ID_ЗАДАЧИ
```

# **Важная информация**
- Доступен только endpoint для проверки конкретной задачи: GET /api/v1/expressions/{id}
- Endpoint для получения списка всех задач (GET /api/v1/expressions) отключен и больше не поддерживается
- Все запросы требуют валидного JWT токена

# Тестирование

В программе имеются модульные и интеграционные тесты. Они указаны в файле `test/test.go`
